<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Speech to Text</title>
  </head>
  <body>
    <h1>Speech-to-Text Demo</h1>
    <button id="startRecord">Start Recording</button>
    <button id="stopRecord" disabled>Stop Recording</button>
    <p id="transcription">Transcription:</p>

    <script>
      let mediaRecorder;
      let audioChunks = [];

      document
        .getElementById("startRecord")
        .addEventListener("click", async () => {
          const stream = await navigator.mediaDevices.getUserMedia({
            audio: true,
          });
          mediaRecorder = new MediaRecorder(stream);

          mediaRecorder.ondataavailable = (event) => {
            audioChunks.push(event.data);
          };

          mediaRecorder.onstop = async () => {
            const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
            audioChunks = [];

            // Convert Blob to ArrayBuffer
            const arrayBuffer = await audioBlob.arrayBuffer();

            const response = await fetch(
              "http://localhost:7071/api/SpeechToText",
              {
                method: "POST",
                headers: { "Content-Type": "application/octet-stream" }, // Send as binary data
                body: arrayBuffer,
              }
            );

            const transcription = await response.text();
            console.log(transcription);
            document.getElementById("transcription").innerText =
              "Transcription: " + transcription;
          };

          mediaRecorder.start();
          document.getElementById("startRecord").disabled = true;
          document.getElementById("stopRecord").disabled = false;
        });

      document.getElementById("stopRecord").addEventListener("click", () => {
        mediaRecorder.stop();
        document.getElementById("startRecord").disabled = false;
        document.getElementById("stopRecord").disabled = true;
      });
    </script>
  </body>
</html>
